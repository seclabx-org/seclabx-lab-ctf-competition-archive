# 🧭 总体目标

```
公开资源仓库
↓
学生参与贡献
↓
必须经过 Review + CI/CD 测试
↓
验证通过才能进入 main 正式版本
```

------

# 🧑‍🏫 老师布置任务流程

```
老师
|
|-- 1）在 Issues / Projects 创建任务
|       - 任务描述
|       - 需要收录的比赛
|       - 要求（结构 / SOURCE / LICENSE）
|       - PR 目标：develop
|
|-- 2）指定学生 / 或开放认领
|
|-- 3）学生 comment：/claim 认领
|
|-- 4）Issue 绑定 PR 追踪
```

------

# 🧑‍🎓 学生标准工作流

```
学生
|
|-- 1）Fork 仓库
|
|-- 2）创建工作分支
|       feat/<比赛>-<题目>
|
|-- 3）按照规范添加内容
|       /competitions/xxx/...
|       SOURCE.md
|       不删除原 LICENSE
|
|-- 4）push 到自己的 Fork
|
|-- 5）创建 PR → 目标 develop
|       标题：add: <比赛>-<题目>
|       关联 Issue
|
|-- 6）等待 review / CI 测试
```

------

# 🔁 完整端到端流程（ASCII 绘图）

```
┌────────────────────────────┐
│           老师布置任务      │
│  Issues / Project / 说明文档 │
└──────────────┬──────────────┘
               │
               ▼
      ┌────────────────┐
      │   学生 Fork 仓库│
      └───────┬────────┘
              │
              ▼
   ┌──────────────────────┐
   │ 创建分支 feat/...     │
   │ 添加题目 + SOURCE + 规范│
   └───────────┬──────────┘
               │
               ▼
   ┌──────────────────────┐
   │  提交 PR → develop    │
   │  (不能直接 push)      │
   └───────────┬──────────┘
               │
               ▼
   ┌─────────────────────────────┐
   │ GitHub Actions 自动触发      │
   │ ① 构建镜像                   │
   │ ② 推送阿里云镜像仓库         │
   │ ③ 部署到测试环境             │
   └───────────┬─────────────────┘
               │
               ▼
        ┌──────────────┐
        │  测试阶段     │
        │  老师手动验证  │
        └─────┬────────┘
              │
    ┌─────────┴───────────┐
    │                     │
    ▼                     ▼
┌───────────┐     ┌────────────────┐
│  测试失败  │     │ 测试通过        │
└────┬──────┘     └───────┬────────┘
     │                    │
     ▼                    ▼
┌─────────────┐     ┌────────────────────────┐
│  退回修改    │     │  Merge → develop        │
│  PR 评论     │     │  develop 保持可运行状态 │
└────┬────────┘     └───────────┬────────────┘
     │                            │
     └───────────────┐            │
                     ▼            ▼
              学生继续修改   老师准备上线
                                   │
                                   ▼
                 ┌────────────────────────┐
                 │ PR： develop → main     │
                 │ 再跑一次 CI/CD（生产）   │
                 └───────────┬────────────┘
                             │
                             ▼
                       ★ 正式上线 ★
```

------

# 🧪 CI/CD 阶段说明

### PR 阶段：

```
pull_request → develop
|
|-- build docker
|-- push 阿里云镜像仓库 (tag: pr-<PR号>-<题目tag>)
|-- 部署测试环境
```

------

### develop 合并阶段（集成环境）

```
workflow_dispatch（手动触发）
|
|-- build dev 镜像
|-- push registry (tag: dev-<题目tag>)
|-- 自动部署测试服务器
```

------

### main 上线阶段

```
workflow_dispatch（手动触发）
|
|-- build prod 镜像
|-- push registry (tag: latest-<题目tag>)
|-- 部署正式环境
```

------

# ?? 镜像命名规范

```
镜像仓库：crpi-7st94yd1uskrhjrz.cn-chengdu.personal.cr.aliyuncs.com/seclabx/ctf
题目镜像 tag：赛事-年份-类型-题目（全小写，短横线）
题目 tag 示例：lilctf-2025-web-ez-bottle
完整镜像示例：crpi-7st94yd1uskrhjrz.cn-chengdu.personal.cr.aliyuncs.com/seclabx/ctf:lilctf-2025-web-ez-bottle
PR 测试 tag：pr-<PR号>-<题目tag>
集成测试 tag：dev-<题目tag>（手动触发）
生产发布 tag： latest-<题目tag>
```

------

# 🚫 不通过时处理策略

```
CI / 测试失败
↓
不合并 develop
↓
PR 评论修改
↓
重新触发 PR CICD
↓
直到 OK
```

------

# 🧠 规则总结（可以写入 CONTRIBUTING.md）

```
1️⃣ 所有学生 PR 必须目标 develop
2️⃣ PR 必须能构建 & 能跑
3️⃣ PR 必须通过：
   - Review
   - CI/CD 测试
4️⃣ develop 永远保持可运行
5️⃣ 不允许脏代码进 main
6️⃣ main = 只接收 100% 通过版本
```

------

# 题目命名规范

``
目录结构：赛事名/年份/题目类型-题目名
赛事名：保留官方大小写，空格用短横线
年份：4 位
题目类型：web | pwn | reverse | crypto | misc | forensics
题目名：小写 + 短横线 + 无空格/中文
示例：
LilCTF/2025/web-ez-sql
GeekGame/2024/reverse-baby-crack
XCTF/2023/pwn-heap-baby
``
